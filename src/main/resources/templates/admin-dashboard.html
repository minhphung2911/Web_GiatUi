<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bảng Điều Khiển Quản Trị - Fresh Laundry</title>
    <link rel="stylesheet" th:href="@{/css/admin-dashboard.css}">
    <link rel="stylesheet" th:href="@{/css/admin-components.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Custom styles for dropdown */
        .user-profile {
            position: relative;
        }
        
        .user-profile .dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            min-width: 200px;
            z-index: 1000;
            display: none;
        }
        
        .user-profile:hover .dropdown {
            display: block;
        }
        
        .user-profile .dropdown a {
            display: block;
            padding: 12px 15px;
            text-decoration: none;
            color: #333;
            transition: background 0.3s;
        }
        
        .user-profile .dropdown a:hover {
            background: #f5f5f5;
        }
        
        .user-profile .dropdown a i {
            margin-right: 8px;
            width: 20px;
            text-align: center;
        }
    </style>
</head>

<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <h2>Fresh<span>Laundry</span></h2>
                </div>
                <button class="sidebar-close" id="sidebar-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="admin-profile">
                <div class="admin-avatar">
                    <img id="admin-avatar" src="/img/default-avatar.svg" alt="Ảnh Quản Trị Viên">
                </div>
                <div class="admin-info">
                    <h4 id="admin-name">Quản Trị Viên</h4>
                    <p id="admin-role">Quản Trị Viên</p>
                </div>
            </div>

            <nav class="sidebar-nav">
                <ul>
                    <li>
                        <a href="#" class="active" data-section="dashboard">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Tổng Quan</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" data-section="bookings">
                            <i class="fas fa-calendar-alt"></i>
                            <span>Đặt Lịch</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" data-section="customers">
                            <i class="fas fa-users"></i>
                            <span>Khách Hàng</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" data-section="services">
                            <i class="fas fa-concierge-bell"></i>
                            <span>Dịch Vụ</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" data-section="reports">
                            <i class="fas fa-chart-bar"></i>
                            <span>Báo Cáo</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" data-section="settings">
                            <i class="fas fa-cog"></i>
                            <span>Cài Đặt</span>
                        </a>
                    </li>
                </ul>
            </nav>

            <div class="sidebar-footer">
                <a href="#" id="admin-logout">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Đăng Xuất</span>
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <button class="menu-toggle" id="menu-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="page-title">
                        <h1 id="page-title">Tổng Quan</h1>
                        <div class="breadcrumb">
                            <a href="#">Trang chủ</a>
                            <span>/</span>
                            <span id="breadcrumb-current">Tổng Quan</span>
                        </div>
                    </div>
                </div>

                <div class="header-right">
                    <div class="search-box">
                        <input type="text" placeholder="Tìm kiếm...">
                        <button><i class="fas fa-search"></i></button>
                    </div>

                    <div class="notifications">
                        <button class="notification-btn">
                            <i class="fas fa-bell"></i>
                            <span class="badge">3</span>
                        </button>
                        <div class="dropdown">
                            <div class="dropdown-header">
                                <h4>Thông Báo</h4>
                                <a href="#">Đánh dấu tất cả đã đọc</a>
                            </div>
                            <div class="dropdown-body">
                                <a href="#" class="notification-item unread">
                                    <div class="notification-icon booking">
                                        <i class="fas fa-calendar-check"></i>
                                    </div>
                                    <div class="notification-content">
                                        <p>Yêu cầu đặt lịch mới từ Nguyễn Văn A</p>
                                        <span>5 phút trước</span>
                                    </div>
                                </a>
                                <a href="#" class="notification-item unread">
                                    <div class="notification-icon user">
                                        <i class="fas fa-user-plus"></i>
                                    </div>
                                    <div class="notification-content">
                                        <p>Đăng ký người dùng mới: Trần Thị B</p>
                                        <span>1 giờ trước</span>
                                    </div>
                                </a>
                                <a href="#" class="notification-item unread">
                                    <div class="notification-icon alert">
                                        <i class="fas fa-exclamation-triangle"></i>
                                    </div>
                                    <div class="notification-content">
                                        <p>Cảnh báo hệ thống: Sao lưu hoàn tất</p>
                                        <span>3 giờ trước</span>
                                    </div>
                                </a>
                            </div>
                            <div class="dropdown-footer">
                                <a href="#">Xem tất cả thông báo</a>
                            </div>
                        </div>
                    </div>

                    <div class="user-profile">
                        <button class="profile-btn">
                            <img id="header-admin-avatar" src="/img/default-avatar.svg" alt="Ảnh Quản Trị Viên">
                            <span id="header-admin-name">Admin</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="dropdown">
                            <a th:href="@{/}"><i class="fas fa-home"></i> Trang chủ</a>
                            <a href="#"><i class="fas fa-user"></i> Hồ sơ của tôi</a>
                            <a href="#"><i class="fas fa-cog"></i> Cài đặt</a>
                            <a href="#" id="profile-logout"><i class="fas fa-sign-out-alt"></i> Đăng xuất</a>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Content -->
            <div class="content">
                <!-- Dashboard Section -->
                <section id="dashboard-section" class="section active">
                    <div class="stats-cards">
                        <div class="card stat-card">
                            <div class="card-body">
                                <div class="stat-icon">
                                    <i class="fas fa-calendar-check"></i>
                                </div>
                                <div class="stat-details">
                                    <h3>Tổng Đặt Lịch</h3>
                                    <h2 id="total-bookings">0</h2>
                                    <p><span class="text-success"><i class="fas fa-arrow-up"></i> 12.5%</span> so với
                                        tháng trước</p>
                                </div>
                            </div>
                            <div class="card-footer">
                                <a href="#" data-section="bookings" class="nav-link">Xem chi tiết <i class="fas fa-arrow-right"></i></a>
                            </div>
                        </div>

                        <div class="card stat-card">
                            <div class="card-body">
                                <div class="stat-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="stat-details">
                                    <h3>Tổng Khách Hàng</h3>
                                    <h2 id="total-customers">0</h2>
                                    <p><span class="text-success"><i class="fas fa-arrow-up"></i> 8.3%</span> so với
                                        tháng trước</p>
                                </div>
                            </div>
                            <div class="card-footer">
                                <a href="#" data-section="customers" class="nav-link">Xem chi tiết <i class="fas fa-arrow-right"></i></a>
                            </div>
                        </div>

                        <div class="card stat-card">
                            <div class="card-body">
                                <div class="stat-icon">
                                    <i class="fas fa-dollar-sign"></i>
                                </div>
                                <div class="stat-details">
                                    <h3>Tổng Doanh Thu</h3>
                                    <h2 id="total-revenue">0đ</h2>
                                    <p><span class="text-success"><i class="fas fa-arrow-up"></i> 5.7%</span> so với
                                        tháng trước</p>
                                </div>
                            </div>
                            <div class="card-footer">
                                <a href="#" data-section="reports" class="nav-link">Xem chi tiết <i class="fas fa-arrow-right"></i></a>
                            </div>
                        </div>

                        <div class="card stat-card">
                            <div class="card-body">
                                <div class="stat-icon">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div class="stat-details">
                                    <h3>Đơn Hoàn Thành</h3>
                                    <h2 id="completed-bookings">0</h2>
                                    <p><span class="text-success"><i class="fas fa-arrow-up"></i> 3.2%</span> so với
                                        tháng trước</p>
                                </div>
                            </div>
                            <div class="card-footer">
                                <a href="#" data-section="bookings" class="nav-link">Xem chi tiết <i class="fas fa-arrow-right"></i></a>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-8">
                            <div class="card">
                                <div class="card-header">
                                    <h3>Đặt Lịch Gần Đây</h3>
                                    <div class="card-actions">
                                        <button class="btn-icon"><i class="fas fa-ellipsis-v"></i></button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover" id="recent-bookings-table">
                                            <thead>
                                                <tr>
                                                    <th>Mã Đặt Lịch</th>
                                                    <th>Khách Hàng</th>
                                                    <th>Dịch Vụ</th>
                                                    <th>Giá Trị</th>
                                                    <th>Trạng Thái</th>
                                                    <th>Ngày Đặt</th>
                                                    <th>Thao Tác</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Booking rows will be generated dynamically with JavaScript -->
                                                <tr class="loading-row">
                                                    <td colspan="7" class="text-center">
                                                        <div class="loading-spinner">
                                                            <i class="fas fa-spinner fa-spin"></i> Đang tải dữ liệu...
                                                        </div>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="card-footer text-center">
                                    <a href="#" class="btn btn-outline">Xem Tất Cả Đặt Lịch</a>
                                </div>
                            </div>
                        </div>

                        <div class="col-4">
                            <div class="card">
                                <div class="card-header">
                                    <h3>Thống Kê Khách Hàng</h3>
                                    <div class="card-actions">
                                        <button class="btn-icon"><i class="fas fa-ellipsis-v"></i></button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="customerChart"></canvas>
                                    </div>
                                    <div class="chart-legend">
                                        <div class="legend-item">
                                            <span class="legend-color" style="background-color: #4ECDC4;"></span>
                                            <span>Khách Hàng Mới</span>
                                        </div>
                                        <div class="legend-item">
                                            <span class="legend-color" style="background-color: #FF6B6B;"></span>
                                            <span>Khách Hàng Quay Lại</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card mt-4">
                                <div class="card-header">
                                    <h3>Dịch Vụ Phổ Biến</h3>
                                    <div class="card-actions">
                                        <button class="btn-icon"><i class="fas fa-ellipsis-v"></i></button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="serviceChart"></canvas>
                                    </div>
                                    <div class="chart-legend" id="service-chart-legend">
                                        <!-- Service legend items will be generated dynamically with JavaScript -->
                                        <div class="loading-spinner">
                                            <i class="fas fa-spinner fa-spin"></i> Đang tải dữ liệu...
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h3>Tổng Quan Doanh Thu</h3>
                                    <div class="card-actions">
                                        <select class="form-select">
                                            <option>Tháng Này</option>
                                            <option>Tháng Trước</option>
                                            <option>3 Tháng Gần Đây</option>
                                            <option>Năm Nay</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="revenueChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Bookings Section -->
                <section id="bookings-section" class="section">
                    <div class="section-header">
                        <div class="section-title">
                            <h2>Quản Lý Đặt Lịch</h2>
                            <p>Quản lý các đơn đặt lịch của khách hàng</p>
                        </div>
                        <div class="section-actions">
                            <button id="add-booking-btn" class="btn btn-primary">
                                <i class="fas fa-plus"></i> Thêm Đặt Lịch
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="booking-filter">
                                <button class="btn btn-sm btn-filter filter-status active" data-status="all">Tất Cả</button>
                                <button class="btn btn-sm btn-filter filter-status" data-status="PENDING">Đang Chờ</button>
                                <button class="btn btn-sm btn-filter filter-status" data-status="PROCESSING">Đang Xử Lý</button>
                                <button class="btn btn-sm btn-filter filter-status" data-status="COMPLETED">Hoàn Thành</button>
                                <button class="btn btn-sm btn-filter filter-status" data-status="CANCELLED">Đã Hủy</button>
                            </div>
                            <div class="search-box">
                                <input type="text" id="booking-search" placeholder="Tìm kiếm đặt lịch...">
                                <button><i class="fas fa-search"></i></button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="admin-table">
                                    <thead>
                                        <tr>
                                            <th>Mã đơn</th>
                                            <th>Khách hàng</th>
                                            <th>Dịch vụ</th>
                                            <th>Ngày lấy</th>
                                            <th>Tổng tiền</th>
                                            <th>Trạng thái</th>
                                            <th>Thao tác</th>
                                        </tr>
                                    </thead>
                                    <tbody id="bookings-table-body">
                                        <tr>
                                            <td colspan="7" class="text-center">Đang tải dữ liệu...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Customers Section -->
                <section id="customers-section" class="section">
                    <div class="section-header">
                        <div class="section-title">
                            <h2>Quản Lý Khách Hàng</h2>
                            <p>Quản lý thông tin khách hàng</p>
                        </div>
                        <div class="section-actions">
                            <button id="add-customer-btn" class="btn btn-primary">
                                <i class="fas fa-plus"></i> Thêm Khách Hàng
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="search-box">
                                <input type="text" id="customer-search" placeholder="Tìm kiếm khách hàng...">
                                <button><i class="fas fa-search"></i></button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="admin-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Tên</th>
                                            <th>Email</th>
                                            <th>Điện thoại</th>
                                            <th>Trạng thái</th>
                                            <th>Thao tác</th>
                                        </tr>
                                    </thead>
                                    <tbody id="customers-table-body">
                                        <tr>
                                            <td colspan="6" class="text-center">Đang tải dữ liệu...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Services Section -->
                <section id="services-section" class="section">
                    <div class="section-header">
                        <div class="section-title">
                            <h2>Quản Lý Dịch Vụ</h2>
                            <p>Quản lý các dịch vụ giặt ủi</p>
                        </div>
                        <div class="section-actions">
                            <button id="add-service-btn" class="btn btn-primary">
                                <i class="fas fa-plus"></i> Thêm Dịch Vụ
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="search-box">
                                <input type="text" id="service-search" placeholder="Tìm kiếm dịch vụ...">
                                <button><i class="fas fa-search"></i></button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="admin-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Tên dịch vụ</th>
                                            <th>Mô tả</th>
                                            <th>Giá</th>
                                            <th>Trạng thái</th>
                                            <th>Thao tác</th>
                                        </tr>
                                    </thead>
                                    <tbody id="services-table-body">
                                        <tr>
                                            <td colspan="6" class="text-center">Đang tải dữ liệu...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Include modals from fragments -->
    <div th:replace="fragments/admin-modals :: service-modals"></div>
    <div th:replace="fragments/admin-modals :: customer-modals"></div>
    <div th:replace="fragments/admin-modals :: booking-modals"></div>

    <!-- Toast notification -->
    <div id="toast-container"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script th:src="@{/js/api-service.js}"></script>
    <script th:src="@{/js/admin-dashboard.js}"></script>
    <script th:src="@{/js/admin-services.js}"></script>
    <script th:src="@{/js/admin-customers.js}"></script>
    <script th:src="@{/js/admin-bookings.js}"></script>
    <script>
        // Add common toast notification function
        window.showToast = function(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <div class="toast-content">
                    <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close">&times;</button>
            `;
            
            const toastContainer = document.getElementById('toast-container');
            toastContainer.appendChild(toast);
            
            // Add close event
            toast.querySelector('.toast-close').addEventListener('click', function() {
                toast.remove();
            });
            
            // Auto remove after 3 seconds
            setTimeout(function() {
                toast.classList.add('fade-out');
                setTimeout(function() {
                    toast.remove();
                }, 300);
            }, 3000);
        };
    </script>
</body>

</html>